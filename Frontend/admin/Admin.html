<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pixelwave Real Estate</title>
    <link rel="stylesheet" href="admin_styles.css" />

    <script>
        //Delete item
      function deleteItem(id) {
        if (confirm("Are you sure you want to delete this item?")) {
          fetch(`http://localhost:5000/api/v1/item/delete/${id}`, {
            method: "DELETE",
          })
            .then((response) => response.json())
            .then((data) => {
              alert("Item has been deleted successfully.");
              location.reload();
            })
            .catch((error) => console.error("Error deleting item:", error));
        }
      }
    </script>
  </head>
  <body>
    <header>
      <div class="logo">Xero<span>Source</span></div>
    </header>
    <div class="nav-btn">Menu</div>
    <div class="container">
      <div class="sidebar">
        <nav>
          <a href="#">Rich<span>Look</span></a>
          <ul>
            <br>
            <li><a href="#">Dashboard</a></li>
            <li class="active"><a href="Admin.html">Stock Management</a></li>
            <li><a href="User.html">User Management</a></li>
            <li><a href="#">Social</a></li>
            <li><a href="#">Contact</a></li>
          </ul>
        </nav>
      </div>
      <div class="main-content">
        <h1 style="font-size: 35px; color: rgb(58, 58, 58)">
          Stock Management
        </h1>
        <br /><br />
        <button class="add-button">+ Add</button>
        <input type="text" id="searchInput" placeholder="Search..." class="search-bar">
        <table>
          <thead>
            <tr>
              <th>#</th>  
              <th>Item Name</th>
              <th>Brand</th>
              <th>Price</th>
              <th>Qty</th>
              <th>Size</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="itemTableBody">
            <!-- Items will be loaded here by JavaScript -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- The Modal -->
<div id="myModal" class="modal">
    <!-- Modal content -->
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Add New Item</h2>
      <div class="container">  
        <form id="contact" action="" method="post">
          <h3>Quick Contact</h3>
          <h4>Contact us today, and get reply with in 24 hours!</h4>
          <fieldset>
            <input placeholder="Your name" type="text" tabindex="1" required autofocus>
          </fieldset>
          <fieldset>
            <input placeholder="Your Email Address" type="email" tabindex="2" required>
          </fieldset>
          <fieldset>
            <input placeholder="Your Phone Number" type="tel" tabindex="3" required>
          </fieldset>
          <fieldset>
            <input placeholder="Your Web Site starts with http://" type="url" tabindex="4" required>
          </fieldset>
          <fieldset>
            <textarea placeholder="Type your Message Here...." tabindex="5" required></textarea>
          </fieldset>
          <fieldset>
            <button name="submit" type="submit" id="contact-submit" data-submit="...Sending">Submit</button>
          </fieldset>
        </form>
       
        
      </div>
    </div>
  </div>

  

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('keyup', function() {
        const filter = searchInput.value.toUpperCase();
        const rows = document.getElementById("itemTableBody").getElementsByTagName("tr");

        for (let i = 0; i < rows.length; i++) {
            let row = rows[i];
            let textContent = row.textContent || row.innerText;
            if (textContent.toUpperCase().indexOf(filter) > -1) {
                rows[i].style.display = "";
            } else {
                rows[i].style.display = "none";
            }
        }
    });
        fetchItems();

        //Fetch items
        async function fetchItems() {
          try {
            const response = await fetch(
              "http://localhost:5000/api/v1/item/getall"
            );
            if (!response.ok) throw new Error("Failed to fetch");
            const data = await response.json();
            if (data && data.data && data.data.items) {
              displayItems(data.data.items);
            } else {
              console.error("Expected data structure not found:", data);
            }
          } catch (error) {
            console.error("Error fetching items:", error);
          }
        }

        //Display items in table rows
        function displayItems(items) {
          const container = document.getElementById("itemTableBody");
          const staticRow = document.createElement("tr");
          let rowIndex = 1; 
          container.appendChild(staticRow); 

          items.forEach((item) => {
            const row = document.createElement("tr");
            row.innerHTML = `
            <td>${rowIndex}</td>
            <td>${item.item_name}</td>
            <td>${item.brand}</td>
            <td>${item.price}</td>
            <td>${item.qty}</td>
            <td>${item.size}</td>
            <td>${item.enabled ? "Active" : "Inactive"}</td>
            <td>
                <center>
                <button onclick="editItem('${
                  item._id
                }')" class="edit-btn">Edit</button>
                <button onclick="deleteItem('${
                  item._id
                }')" class="delete-btn">Delete</button>
                </center>
            </td>
            `;
            container.appendChild(row);
            rowIndex++;
          });
        }

        document.querySelector(".add-button").addEventListener("click", function() {
  document.getElementById("myModal").style.display = "block";
});

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  document.getElementById("myModal").style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == document.getElementById("myModal")) {
    document.getElementById("myModal").style.display = "none";
  }
}

      });
    </script>
  </body>
</html>
